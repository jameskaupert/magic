---
- name: Install greetd and greeters
  pacman:
    name:
      - greetd
      - greetd-tuigreet
      - greetd-regreet
    state: present

- name: Create custom Hyprland quiet launcher
  copy:
    dest: /usr/local/bin/hyprland-quiet
    mode: '0755'
    content: |
      #!/bin/bash
      exec Hyprland >/dev/null 2>&1

- name: Create custom Hyprland session file
  copy:
    dest: /usr/share/wayland-sessions/hyprland-quiet.desktop
    content: |
      [Desktop Entry]
      Name=Hyprland Quiet
      Comment=An intelligent dynamic tiling Wayland compositor (suppressed output)
      Exec=/usr/local/bin/hyprland-quiet
      Type=Application
      DesktopNames=Hyprland
      Keywords=tiling;wayland;compositor;

- name: Configure greetd
  template:
    src: greetd.conf.j2
    dest: /etc/greetd/config.toml
    backup: yes

- name: Disable getty on tty1 (greetd will handle it)
  systemd:
    name: getty@tty1
    enabled: no
    state: stopped
  ignore_errors: yes

- name: Enable greetd service
  systemd:
    name: greetd
    enabled: yes
    state: started
